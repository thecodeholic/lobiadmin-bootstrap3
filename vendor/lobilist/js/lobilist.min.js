Math.randomString=function(t){for(var i="",e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=0;t>o;o++)i+=e.charAt(Math.floor(Math.random()*e.length));return i},$(function(){var t=function(t,i){this.$lobiList=t,this.$el,this.$options=i,this.$items,this.$globalOptions=t.$options;var e,o,n,s,l,a,d=this,r=function(t){return $.extend({},$.fn.lobiList.OPTIONS.itemOptions,t)},c=function(){d.$options.id||(d.$options.id=Math.randomString(10));var t=$("<div>",{id:d.$options.id,"class":"lobilist"});d.$options.defaultStyle&&t.addClass(d.$options.defaultStyle),d.$el=t,o=p(),n=u(),a=m(),e=g(),i.items&&y(i.items),s=f(),a.append(e,s),l=v(),d.$globalOptions.sortable&&P()},p=function(){var t=$("<div>",{"class":"lobilist-header"}),i=$("<div>",{"class":"lobilist-actions"}).appendTo(t);return d.$options.controls&&d.$options.controls.length>0&&(d.$options.controls.indexOf("styleChange")>-1&&i.append(T()),d.$options.controls.indexOf("edit")>-1&&(i.append(k()),i.append(C()),i.append(S())),d.$options.controls.indexOf("add")>-1&&i.append(x()),d.$options.controls.indexOf("remove")>-1&&i.append(L())),d.$el.append(t),t},u=function(){var t=$("<div>",{"class":"lobilist-title",html:d.$options.title}).appendTo(o);return d.$options.controls&&d.$options.controls.indexOf("edit")>-1&&t.on("dblclick",function(){d.startTitleEditing()}),t},m=function(){return $("<div>",{"class":"lobilist-body"}).appendTo(d.$el)},f=function(){var t=$("<form>",{"class":"lobilist-add-todo-form hide"});$("<input>",{type:"hidden",name:"id"}).appendTo(t),$("<div>",{"class":"form-group"}).append($("<input>",{type:"text",name:"title","class":"form-control",placeholder:"TODO title"})).appendTo(t),$("<div>",{"class":"form-group"}).append($("<textarea>",{rows:"2",name:"description","class":"form-control",placeholder:"TODO description"})).appendTo(t),$("<div>",{"class":"form-group"}).append($("<input>",{type:"text",name:"dueDate","class":"form-control",placeholder:"Due Date"})).appendTo(t);var i=$("<div>",{"class":"lobilist-form-footer"});return $("<button>",{"class":"btn btn-primary btn-sm btn-add-todo",html:"Add"}).appendTo(i),$("<button>",{type:"button","class":"btn btn-default btn-sm btn-discard-todo",html:'<i class="glyphicon glyphicon-remove-circle"></i>'}).click(function(){s.addClass("hide"),l.removeClass("hide")}).appendTo(i),i.appendTo(t),b(t),d.$el.append(t),t},b=function(t){t.on("submit",function(t){t.preventDefault(),h()})},h=function(){return s[0].title.value?(d.saveOrUpdateItem({id:s[0].id.value,title:s[0].title.value,description:s[0].description.value,dueDate:s[0].dueDate.value}),s.addClass("hide"),void l.removeClass("hide")):void A("title","Title can not be empty")},v=function(){var t=$("<div>",{"class":"lobilist-footer"});return $("<button>",{type:"button","class":"btn-link btn-show-form",html:"Add new"}).click(function(){E(),s.removeClass("hide"),l.addClass("hide")}).appendTo(t),d.$el.append(t),t},g=function(){var t=$("<ul>",{"class":"lobilist-items"});return d.$el.append(t),t},y=function(t){for(var i=0;i<t.length;i++)I(t[i])},I=function(t){t.id||(t.id=d.$lobiList.getNextId()),t=r(t),w(t)},O=function(){var t=$("<input>",{type:"checkbox"});t.change(function(){t.closest(".lobilist-item").toggleClass("item-done")});var i=$("<label>",{"class":"checkbox-inline lobilist-check"}).append(t);return d.$options.useLobicheck&&(i.addClass("lobicheck").addClass(d.$options.lobicheckClass),i.append("<i></i>")),i},T=function(){for(var t=$("<div>",{"class":"dropdown"}).append($("<button>",{type:"button","data-toggle":"dropdown","class":"btn btn-default btn-xs",html:'<i class="glyphicon glyphicon-th"></i>'})),i=$("<div>",{"class":"dropdown-menu dropdown-menu-right"}).appendTo(t),e=0;e<$.fn.lobiList.OPTIONS.listStyles.length;e++){var o=$.fn.lobiList.OPTIONS.listStyles[e];$('<div class="'+o+'"></div>').on("mousedown",function(t){t.stopPropagation()}).click(function(){d.$el.removeClass($.fn.lobiList.OPTIONS.listStyles.join(" ")).addClass(this.className)}).appendTo(i)}return t},k=function(){var t=$("<button>",{"class":"btn btn-default btn-xs",html:'<i class="glyphicon glyphicon-edit"></i>'});return t.click(function(){d.startTitleEditing()}),t},x=function(){var t=$("<button>",{"class":"btn btn-default btn-xs",html:'<i class="glyphicon glyphicon-plus"></i>'});return t.click(function(){var t=d.$lobiList.addList();t.startTitleEditing()}),t},L=function(){var t=$("<button>",{"class":"btn btn-default btn-xs",html:'<i class="glyphicon glyphicon-remove"></i>'});return t.click(function(){d.remove()}),t},C=function(){var t=$("<button>",{"class":"btn btn-default btn-xs btn-finish-title-editing",html:'<i class="glyphicon glyphicon-ok-circle"></i>'});return t.click(function(){d.finishTitleEditing()}),t},S=function(){var t=$("<button>",{"class":"btn btn-default btn-xs btn-cancel-title-editing",html:'<i class="glyphicon glyphicon-remove-circle"></i>'});return t.click(function(){d.cancelTitleEditing()}),t},D=function(){var t=$("<input>",{type:"text","class":"form-control"});return t.on("keyup",function(t){13===t.which&&d.finishTitleEditing()}),t},A=function(t,i){var e=s.find('[name="'+t+'"]').closest(".form-group").addClass("has-error");e.find(".help-block").remove(),e.append($("<span>",{"class":"help-block",html:i}))},E=function(){s[0].reset(),s[0].id.value="",s.find(".form-group").removeClass("has-error").find(".help-block").remove()},P=function(){d.$el.find(".lobilist-items").sortable({connectWith:".lobilist .lobilist-items",items:".lobilist-item",handle:".drag-handler",cursor:"move",placeholder:"lobilist-item-placeholder",forcePlaceholderSize:!0,opacity:.9,revert:70})},w=function(t){var i=$("<li>",{"data-id":t.id,"class":"lobilist-item"});return i.append($("<div>",{"class":"lobilist-item-title",html:t.title})),t.description&&i.append($("<div>",{"class":"lobilist-item-description",html:t.description})),t.dueDate&&i.append($("<div>",{"class":"lobilist-item-duedate",html:t.dueDate})),i=N(i),t.done&&(i.find("input[type=checkbox]").prop("checked",!0),i.addClass("item-done")),i.data("lobiListItem",t),e.append(i),i},N=function(t){return d.$options.useCheckboxes&&t.append(O()),d.$options.removeItemButton&&t.append($("<div>",{"class":"delete-todo",html:'<i class="glyphicon glyphicon-remove"></i>'}).click(function(){d.deleteItem($(this).closest("li").data("lobiListItem"))})),d.$options.editItemButton&&t.append($("<div>",{"class":"edit-todo",html:'<i class="glyphicon glyphicon-pencil"></i>'}).click(function(){d.editItem($(this).closest("li").data("id"))})),t.append($("<div>",{"class":"drag-handler"})),t},U=function(t){var i=d.$lobiList.$el.find('li[data-id="'+t.id+'"]');i.find("input[type=checkbox]").prop("checked",t.done),i.find(".lobilist-item-title").html(t.title),i.find(".lobilist-item-description").remove(),i.find(".lobilist-item-duedate").remove(),t.description&&i.append('<div class="lobilist-item-description">'+t.description+"</div>"),t.dueDate&&i.append('<div class="lobilist-item-duedate">'+t.dueDate+"</div>"),i.data("lobiListItem",t)};this.addItem=function(t){d.$options.onItemAdd&&d.$options.onItemAdd(d,t);var i=!1;return t=r(t),d.$globalOptions.actions.insert?$.ajax(d.$globalOptions.actions.insert,{data:t,method:"POST",async:!1}).done(function(e){e.success?(i=!0,t.id=e.id):Lobibox.notify("error",{msg:e.msg||"Error occured"})}):(i=!0,t.id=d.$lobiList.getNextId()),i&&w(t),d.$options.afterItemAdd&&d.$options.afterItemAdd(d,t),d},this.updateItem=function(t){d.$options.onItemUpdate&&d.$options.onItemUpdate(d,t);var i=!1;return d.$globalOptions.actions.update?$.ajax(d.$globalOptions.actions.update,{data:t,method:"POST",async:!1}).done(function(t){t.success?i=!0:Lobibox.notify("error",{msg:t.msg||"Error occured"})}):i=!0,i&&U(t),d.$options.afterItemUpdate&&d.$options.afterItemUpdate(d,t),d},this.deleteItem=function(t,i){var e=!0;if(!i&&d.$options.onItemDelete&&(e=d.$options.onItemDelete(d,t)),e===!1)return d;var o=!1;return d.$globalOptions.actions["delete"]?$.ajax(d.$globalOptions.actions["delete"],{data:t,method:"POST",async:!1}).done(function(t){t.success?o=!0:Lobibox.notify("error",{msg:t.msg||"Error occured"})}):o=!0,o&&d.$lobiList.$el.find("li[data-id="+t.id+"]").remove(),d.$options.afterItemDelete&&d.$options.afterItemDelete(d,t),d},this.saveOrUpdateItem=function(t){return t.id?d.updateItem(t):d.addItem(t),d},this.startTitleEditing=function(){var t=D();return n.attr("data-old-title",n.html()),t.val(n.html()),t.insertAfter(n),n.addClass("hide"),o.addClass("title-editing"),t[0].focus(),t[0].select(),d},this.finishTitleEditing=function(){var t=o.find("input");return n.html(t.val()).removeClass("hide").removeAttr("data-old-title"),t.remove(),o.removeClass("title-editing"),d},this.cancelTitleEditing=function(){var t=o.find("input");return 0===t.length?d:(n.html(n.attr("data-old-title")).removeClass("hide"),t.remove(),o.removeClass("title-editing"),d)},this.remove=function(t){var i=!0;return!t&&d.$options.onRemove&&(i=d.$options.onRemove(d)),i===!1?d:(d.$lobiList.$lists.splice(d.$el.index(),1),d.$el.remove(),d.$options.afterRemove&&d.$options.afterRemove(d),d)},this.editItem=function(t){var i=d.$lobiList.$el.find("li[data-id="+t+"]"),e=i.closest(".lobilist").find(".lobilist-add-todo-form"),o=i.closest(".lobilist").find(".lobilist-footer");e.removeClass("hide"),o.addClass("hide"),e[0].id.value=i.attr("data-id"),e[0].title.value=i.find(".lobilist-item-title").html();var n=i.find(".lobilist-item-description").html()||"";e[0].description.value=n;var s=i.find(".lobilist-item-duedate").html()||"";return e[0].dueDate.value=s,d},c()},i=function(i,e){this.$el,this.$lists=[],this.$options;var o=this,n=1,s=function(t){return t=$.extend({},$.fn.lobiList.DEFAULT_OPTIONS,t),t.actions.load&&$.ajax(t.actions.load,{async:!1}).done(function(i){t.lists=i.lists}),t},l=function(t){t=$.extend({},$.fn.lobiList.OPTIONS.listsOptions,t);for(var i=["useCheckboxes","useLobicheck","lobicheckClass","removeItemButton","editItemButton","sortable","controls","defaultStyle","onAdd","onRemove","afterRemove","onItemAdd","afterItemAdd","onItemUpdate","afterItemUpdate","onItemDelete","afterItemDelete"],e=0;e<i.length;e++)void 0===t[i[e]]&&(t[i[e]]=o.$options[i[e]]);return t},a=function(){o.$el.addClass("lobilists"),d(),o.$options.sortable&&o.$el.sortable({items:".lobilist",handle:".lobilist-header",cursor:"move",placeholder:"lobilist-placeholder",forcePlaceholderSize:!0,opacity:.9,revert:70}),o.$options.onInit&&o.$options.onInit(o)},d=function(){for(var t=0;t<o.$options.lists.length;t++)o.addList(o.$options.lists[t])};this.addList=function(i){var e;return i instanceof t?e=i:(i=l(i),e=new t(o,i)),o.$lists.push(e),o.$el.append(e.$el),e.$el.data("lobiList",e),o.$options.onAdd&&o.$options.onAdd(o),e},this.getNextId=function(){return n++},this.$el=i,this.$options=s(e),a()};$.fn.lobiList=function(t){var e,o=arguments;return this.each(function(){var n=$(this),s=n.data("lobiList"),l="object"==typeof t&&t;s||n.data("lobiList",s=new i(n,l)),"string"==typeof t&&(o=Array.prototype.slice.call(o,1),e=s[t].apply(s,o))})},$.fn.lobiList.OPTIONS={listStyles:["lobilist-default","lobilist-danger","lobilist-success","lobilist-warning","lobilist-info","lobilist-primary"],listsOptions:{id:!1,title:"",items:[]},itemOptions:{id:!1,title:"",description:"",dueDate:"",done:!1}},$.fn.lobiList.DEFAULT_OPTIONS={lists:[],actions:{load:"",update:"",insert:"","delete":""},useCheckboxes:!0,useLobicheck:!0,lobicheckClass:"lobicheck-info lobicheck-inversed",removeItemButton:!0,editItemButton:!0,sortable:!0,controls:["edit","add","remove","styleChange"],defaultStyle:"lobilist-default"},$(".lobilists").lobiList()});