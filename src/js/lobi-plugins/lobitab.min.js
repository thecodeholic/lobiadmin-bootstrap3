Math.randomString=function(t){for(var n="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=0;t>e;e++)n+=i.charAt(Math.floor(Math.random()*i.length));return n},$(function(){var t=function(n,i){this.$el,this.$nav,this.$content,this.$options;var e=this,a=function(n){return n=$.extend({},t.DEFAULT_OPTIONS,n)},o=function(){e.$el.addClass("lobitab"),e.$nav=e.$el.find(">.nav-tabs"),e.$content=e.$el.find(">.tab-content"),p(),l(),e.enableClose(),c(),u(),m(),g("init.lobiTab")},l=function(){if(e.$options.showAddNewBtn){var t=$('<li class="lobitab-add-new"></li>').append($('<a role="tab" data-toggle="tab">\n                        <i class="'+e.$options.addNewTabIcon+'"></i>\n                    </a>'));e.$el.find(">.nav-tabs").append(t),t.click(function(t){t.stopPropagation(),r()})}},r=function(){e.addNewTab()},s=function(t){return $('<li><a href="'+t+'" role="tab" data-toggle="tab"><span class="lobitab-title"></span></a></li>')},d=function(t){return $('<div class="tab-pane" id="'+t+'"></div>')},f=function(){var t=$('<input type="text"/>');return t.on("keyup",function(t){13===t.which&&e.finishTitleEditing()}),t.on("blur",function(){e.finishTitleEditing()}),t},c=function(){e.$options.editTitle&&e.$nav.find("a").on("dblclick",function(){e.startTitleEditing($(this))})},b=function(t){e.$options.editTitle&&t.on("dblclick",function(){e.startTitleEditing(t.attr("href"))})},u=function(){e.$options.closeOnWheelClick&&e.$nav.find("a").on("click",function(t){t.preventDefault(),2===t.which&&e.removeTab($(this).attr("href"))})},h=function(t){t.on("click",function(t){t.preventDefault(),2===t.which&&e.removeTab($(this))})},p=function(){e.$options.sortable&&w();var t=e.$nav.find("a:not(:has(.lobitab-title))");t.each(function(t,n){var i=$(n);i.html('<span class="lobitab-title">'+i.html()+"</span>")})},v=function(t){if(e.$options.closable&&!(t.find(".lobitab-close").length>0)){var n=$('<button class="lobitab-close">&times;</button>');n.click(function(t){t.preventDefault(),t.stopPropagation();var n=$(this).parent();e.removeTab(n)}),t.append(n)}},g=function(t){var n=Array.prototype.slice.call(arguments,1);n.unshift(e),e.debug('event "'+t+'" triggered'),e.$el.trigger(t,n)},T=function(t){if(t.hasClass("active")){var n=t.prev();return 0===n.length&&(n=t.next()),0===n.length&&t.closest("ul").hasClass("dropdown-menu")?T(t.closest("ul").parent()):n.find(">a")}return null},w=function(){e.$nav.sortable({items:"li:not(.lobitab-add-new)",placeholder:"lobitab-placeholder",forcePlaceholderSize:!0})},m=function(){if(e.$options.loadByAjax)if(e.$options.lazyLoad){var t=e.$nav.find("li.active a");y(t),C()}else{var n=e.$nav.find("a");n.each(function(t,n){y($(n))})}},y=function(t){var n=t.data("load-url"),i=$(t.attr("href"));n&&(i.data("loaded")&&e.$options.loadOnce||i.load(t.data("load-url"),null,function(){i.data("loaded",!0)}))},C=function(){e.$el.find("[data-toggle=tab]").on("show.bs.tab",function(){e.$options.loadByAjax&&y($(this))})};this.debug=function(){e.$options.debug&&window.console.log.apply(window.console,arguments)},this.startTitleEditing=function(t){var n=t;"string"==typeof t&&(n=e.$nav.find('a[href="'+t+'"]')),e.isTitleEditing()&&e.finishTitleEditing();var i=f();return i.insertAfter(n.find(".lobitab-title")),i.val(n.find(".lobitab-title").html()),n.find(".lobitab-title, .lobitab-close").hide(),i[0].focus(),i[0].select(),g("startEditing.lobiTab",n),e},this.finishTitleEditing=function(){var t=e.$nav.find("input"),n=t.parent();return n.find(".lobitab-title").html(t.val()).show(),n.find(".lobitab-close").show(),t.remove(),g("finishEditing.lobiTab",n),e},this.isTitleEditing=function(){var t=e.$nav.find("input");return 0===t.length?!1:!0},this.enableClose=function(){var t=e.$nav.find("li");return t.each(function(t,n){var i=$(n);i.hasClass("lobitab-add-new")||v(i.find(">a"))}),e},this.disableClose=function(){return e.$nav.find("a .lobitab-close").remove(),e},this.removeTab=function(t){var n;if("string"==typeof t)n=e.$nav.find('a[href="'+t+'"]').parent();else if(t instanceof jQuery){if(0===t.length)return e;t.length>1?t.each(function(t,n){e.removeTab($(n))}):(n=t.parent(),t=t.attr("href"))}var i=n.find(".dropdown-menu");if(i.length>0)i.each(function(t,n){var i=$(n).find(">li>a");i.each(function(t,n){e.removeTab($(n))})});else{var a=$(t);a.remove();var o=n.parent(),l=T(n);l&&l.tab("show"),n.remove(),o.hasClass("dropdown-menu")&&0===o.find(">li").length&&o.closest("li").remove(),g("removed.lobiTab",t)}return e},this.addNewTab=function(t,n,i){t||(t=e.$options.newTabTitle),n||(n=e.$options.newTabContent),i||(i=Math.randomString(10));var a=d(i),o="#"+i,l=s(o);l.find("a .lobitab-title").html(t),a.html(n);var r=e.$nav.find(".lobitab-add-new");0===r.length?e.$nav.append(l):l.insertBefore(r),e.$content.append(a);var f=l.find("a");return e.$options.newTabSetActive&&f.tab("show"),v(f),b(f),h(f),g("added.lobiTab",f),e.$options.editTitle&&e.$options.editNewTab&&e.startTitleEditing(f),e},this.getTitle=function(t){var n=t;return"string"==typeof t&&(n=e.$nav.find('a[href="'+t+'"]')),n.find(".lobitab-title").html()},this.setNewTabTitle=function(t){return e.$options.newTabTitle=t,e},this.setNewTabContent=function(t){return e.$options.newTabContent=t,e},this.setTitle=function(t,n){var i=t;return"string"==typeof t&&(i=e.$nav.find('a[href="'+t+'"]')),i.find(".lobitab-title").html(n),e},this.setContent=function(t,n){var i=t;return"string"==typeof t&&(i=e.$content.find(t)),i.html(n),e},this.$el=n,this.$options=a(i),o(),e.debug(e)};t.DEFAULT_OPTIONS={debug:!1,newTabTitle:"new tab",newTabContent:"",closable:!0,editTitle:!0,showAddNewBtn:!0,editNewTab:!0,newTabSetActive:!0,closeOnWheelClick:!0,sortable:!0,addNewTabIcon:"glyphicon glyphicon-plus-sign",loadByAjax:!0,lazyLoad:!0,loadOnce:!1},$.fn.lobiTab=function(n){var i,e=arguments;return this.each(function(){var a=$(this),o=a.data("lobiTab"),l="object"==typeof n&&n;o||a.data("lobiTab",o=new t(a,l)),"string"==typeof n&&(e=Array.prototype.slice.call(e,1),i=o[n].apply(o,e))})},$(".lobitab").lobiTab()});