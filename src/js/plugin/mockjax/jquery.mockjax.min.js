/*!
 * MockJax - jQuery Plugin to Mock Ajax requests
 *
 * Version:  1.6.1
 * Released:
 * Home:   https://github.com/jakerella/jquery-mockjax
 * Author:   Jonathan Sharp (http://jdsharp.com)
 * License:  MIT,GPL
 *
 * Copyright (c) 2014 appendTo, Jordan Kasper
 * NOTE: This repository was taken over by Jordan Kasper (@jakerella) October, 2014
 * 
 * Dual licensed under the MIT or GPL licenses.
 * http://opensource.org/licenses/MIT OR http://www.gnu.org/licenses/gpl-2.0.html
 */
!function(e){function t(t){void 0==window.DOMParser&&window.ActiveXObject&&(DOMParser=function(){},DOMParser.prototype.parseFromString=function(e){var t=new ActiveXObject("Microsoft.XMLDOM");return t.async="false",t.loadXML(e),t});try{var n=(new DOMParser).parseFromString(t,"text/xml");if(!e.isXMLDoc(n))throw new Error("Unable to parse XML");var o=e("parsererror",n);if(1==o.length)throw new Error("Error: "+e(n).text());return n}catch(s){var r=void 0==s.name?s:s.name+": "+s.message;return void e(document).trigger("xmlParseError",[r])}}function n(t,o){var s=!0;return"string"==typeof o?e.isFunction(t.test)?t.test(o):t==o:(e.each(t,function(r){return void 0===o[r]?s=!1:void("object"==typeof o[r]&&null!==o[r]?(s&&e.isArray(o[r])&&(s=e.isArray(t[r])&&o[r].length===t[r].length),s=s&&n(t[r],o[r])):s=t[r]&&e.isFunction(t[r].test)?s&&t[r].test(o[r]):s&&t[r]==o[r])}),s)}function o(t,n){return t[n]===e.mockjaxSettings[n]}function s(t,o){if(e.isFunction(t))return t(o);if(e.isFunction(t.url.test)){if(!t.url.test(o.url))return null}else{var s=t.url.indexOf("*");if(t.url!==o.url&&-1===s||!new RegExp(t.url.replace(/[-[\]{}()+?.,\\^$|#\s]/g,"\\$&").replace(/\*/g,".+")).test(o.url))return null}return!t.data||o.data&&n(t.data,o.data)?t&&t.type&&t.type.toLowerCase()!=o.type.toLowerCase()?null:t:null}function r(t){if(e.isArray(t)){var n=t[0],o=t[1];return"number"==typeof n&&"number"==typeof o?Math.floor(Math.random()*(o-n))+n:null}return"number"==typeof t?t:null}function a(n,s,a){var i=function(o){return function(){return function(){this.status=n.status,this.statusText=n.statusText,this.readyState=1;var r=function(){this.readyState=4;var o;"json"==s.dataType&&"object"==typeof n.responseText?this.responseText=JSON.stringify(n.responseText):"xml"==s.dataType?"string"==typeof n.responseXML?(this.responseXML=t(n.responseXML),this.responseText=n.responseXML):this.responseXML=n.responseXML:"object"==typeof n.responseText&&null!==n.responseText?(n.contentType="application/json",this.responseText=JSON.stringify(n.responseText)):this.responseText=n.responseText,("number"==typeof n.status||"string"==typeof n.status)&&(this.status=n.status),"string"==typeof n.statusText&&(this.statusText=n.statusText),o=this.onreadystatechange||this.onload,e.isFunction(o)?(n.isTimeout&&(this.status=-1),o.call(this,n.isTimeout?"timeout":void 0)):n.isTimeout&&(this.status=-1)};if(e.isFunction(n.response)){if(2===n.response.length)return void n.response(a,function(){r.call(o)});n.response(a)}r.call(o)}.apply(o)}}(this);n.proxy?g({global:!1,url:n.proxy,type:n.proxyType,data:n.data,dataType:"script"===s.dataType?"text/plain":s.dataType,complete:function(e){n.responseXML=e.responseXML,n.responseText=e.responseText,o(n,"status")&&(n.status=e.status),o(n,"statusText")&&(n.statusText=e.statusText),this.responseTimer=setTimeout(i,r(n.responseTime)||0)}}):s.async===!1?i():this.responseTimer=setTimeout(i,r(n.responseTime)||50)}function i(t,n,o,s){return t=e.extend(!0,{},e.mockjaxSettings,t),"undefined"==typeof t.headers&&(t.headers={}),"undefined"==typeof n.headers&&(n.headers={}),t.contentType&&(t.headers["content-type"]=t.contentType),{status:t.status,statusText:t.statusText,readyState:1,open:function(){},send:function(){s.fired=!0,a.call(this,t,n,o)},abort:function(){clearTimeout(this.responseTimer)},setRequestHeader:function(e,t){n.headers[e]=t},getResponseHeader:function(e){return t.headers&&t.headers[e]?t.headers[e]:"last-modified"==e.toLowerCase()?t.lastModified||(new Date).toString():"etag"==e.toLowerCase()?t.etag||"":"content-type"==e.toLowerCase()?t.contentType||"text/plain":void 0},getAllResponseHeaders:function(){var n="";return t.contentType&&(t.headers["Content-Type"]=t.contentType),e.each(t.headers,function(e,t){n+=e+": "+t+"\n"}),n}}}function u(e,t,n){if(c(e),e.dataType="json",e.data&&v.test(e.data)||v.test(e.url)){p(e,t,n);var o=/^(\w+:)?\/\/([^\/?#]+)/,s=o.exec(e.url),r=s&&(s[1]&&s[1]!==location.protocol||s[2]!==location.host);if(e.dataType="script","GET"===e.type.toUpperCase()&&r){var a=l(e,t,n);return a?a:!0}}return null}function c(e){"GET"===e.type.toUpperCase()?v.test(e.url)||(e.url+=(/\?/.test(e.url)?"&":"?")+(e.jsonp||"callback")+"=?"):e.data&&v.test(e.data)||(e.data=(e.data?e.data+"&":"")+(e.jsonp||"callback")+"=?")}function l(t,n,o){var s=o&&o.context||t,a=null;return n.response&&e.isFunction(n.response)?n.response(o):e.globalEval("object"==typeof n.responseText?"("+JSON.stringify(n.responseText)+")":"("+n.responseText+")"),setTimeout(function(){f(t,s,n),d(t,s,n)},r(n.responseTime)||0),e.Deferred&&(a=new e.Deferred,"object"==typeof n.responseText?a.resolveWith(s,[n.responseText]):a.resolveWith(s,[e.parseJSON(n.responseText)])),a}function p(e,t,n){var o=n&&n.context||e,s=e.jsonpCallback||"jsonp"+w++;e.data&&(e.data=(e.data+"").replace(v,"="+s+"$1")),e.url=e.url.replace(v,"="+s+"$1"),window[s]=window[s]||function(n){data=n,f(e,o,t),d(e,o,t),window[s]=void 0;try{delete window[s]}catch(r){}head&&head.removeChild(script)}}function f(t,n,o){t.success&&t.success.call(n,o.responseText||"",status,{}),t.global&&(t.context?e(t.context):e.event).trigger("ajaxSuccess",[{},t])}function d(t,n){t.complete&&t.complete.call(n,{},status),t.global&&(t.context?e(t.context):e.event).trigger("ajaxComplete",[{},t]),t.global&&!--e.active&&e.event.trigger("ajaxStop")}function x(t,n){var o,r,a,c;"object"==typeof t?(n=t,t=void 0):(n=n||{},n.url=t),r=e.extend(!0,{},e.ajaxSettings,n),c=function(t,o){var s=n[t.toLowerCase()];return function(){e.isFunction(s)&&s.apply(this,[].slice.call(arguments)),o["onAfter"+t]()}};for(var l=0;l<m.length;l++)if(m[l]&&(a=s(m[l],r)))return T.push(r),e.mockjaxSettings.log(a,r),r.dataType&&"JSONP"===r.dataType.toUpperCase()&&(o=u(r,a,n))?o:(a.cache=r.cache,a.timeout=r.timeout,a.global=r.global,a.isTimeout&&(a.responseTime>1?n.timeout=a.responseTime-1:(a.responseTime=2,n.timeout=1),a.isTimeout=!1),e.isFunction(a.onAfterSuccess)&&(n.success=c("Success",a)),e.isFunction(a.onAfterError)&&(n.error=c("Error",a)),e.isFunction(a.onAfterComplete)&&(n.complete=c("Complete",a)),h(a,n),function(t,n,s,r){o=g.call(e,e.extend(!0,{},s,{xhr:function(){return i(t,n,s,r)}}))}(a,r,n,m[l]),o);if(y.push(n),e.mockjaxSettings.throwUnmocked===!0)throw new Error("AJAX not mocked: "+n.url);return g.apply(e,[n])}function h(e,t){if(e.url instanceof RegExp&&e.hasOwnProperty("urlParams")){var n=e.url.exec(t.url);if(1!==n.length){n.shift();var o=0,s=n.length,r=e.urlParams.length,a=Math.min(s,r),i={};for(o;a>o;o++){var u=e.urlParams[o];i[u]=n[o]}t.urlParams=i}}}var g=e.ajax,m=[],T=[],y=[],v=/=\?(&|$)/,w=(new Date).getTime();e.extend({ajax:x}),e.mockjaxSettings={log:function(t,n){if(t.logging!==!1&&("undefined"!=typeof t.logging||e.mockjaxSettings.logging!==!1)&&window.console&&console.log){var o="MOCK "+n.type.toUpperCase()+": "+n.url,s=e.extend({},n);if("function"==typeof console.log)console.log(o,s);else try{console.log(o+" "+JSON.stringify(s))}catch(r){console.log(o)}}},logging:!0,status:200,statusText:"OK",responseTime:500,isTimeout:!1,throwUnmocked:!1,contentType:"text/plain",response:"",responseText:"",responseXML:"",proxy:"",proxyType:"GET",lastModified:null,etag:"",headers:{etag:"IJF@H#@923uf8023hFO@I#H#","content-type":"text/plain"}},e.mockjax=function(e){var t=m.length;return m[t]=e,t},e.mockjax.clear=function(e){1==arguments.length?m[e]=null:m=[],T=[],y=[]},e.mockjaxClear=function(){window.console&&window.console.warn&&window.console.warn("DEPRECATED: The $.mockjaxClear() method has been deprecated in 1.6.0. Please use $.mockjax.clear() as the older function will be removed soon!"),e.mockjax.clear()},e.mockjax.handler=function(e){return 1==arguments.length?m[e]:void 0},e.mockjax.mockedAjaxCalls=function(){return T},e.mockjax.unfiredHandlers=function(){for(var e=[],t=0,n=m.length;n>t;t++){var o=m[t];null===o||o.fired||e.push(o)}return e},e.mockjax.unmockedAjaxCalls=function(){return y}}(jQuery);